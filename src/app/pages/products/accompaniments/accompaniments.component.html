<p-toolbar styleClass="mb-6">
    <ng-template pTemplate="start">
        <p-button label="Nuevo Acompañamiento" icon="pi pi-plus" severity="secondary" class="mr-2" (onClick)="openNew()" />
        <p-button severity="secondary" label="Eliminar Seleccionados" icon="pi pi-trash" outlined [disabled]="!selectedAccompaniments() || !selectedAccompaniments().length" />
    </ng-template>

    <ng-template pTemplate="end">
        <div class="flex gap-2">
            <p-button label="Limpiar Filtros" icon="pi pi-filter-slash" outlined severity="secondary" (onClick)="clearFilters()" />
            <p-button label="Exportar" icon="pi pi-upload" severity="secondary" (onClick)="exportCSV()" />
        </div>
    </ng-template>
</p-toolbar>

<!-- Categories with Accompaniments -->
<div class="card" *ngIf="categories().length > 0">
    <p-table [value]="categories()" dataKey="categoryItemCode" styleClass="p-datatable-striped">
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 5rem"></th> <!-- Toggler -->
                <th>Categoría</th>
                <th style="width: 20rem">Información</th>
                <th style="width: 15rem">Acciones</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-category let-expanded="expanded">
            <tr>
                <td>
                    <p-button 
                        (click)="toggleRow(category.categoryItemCode)"
                        [text]="true" 
                        [rounded]="true" 
                        [icon]="isRowExpanded(category.categoryItemCode) ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" 
                        size="small">
                    </p-button>
                </td>
                <td>
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-surface-100 dark:bg-surface-700 rounded-lg flex items-center justify-center flex-shrink-0">
                            <img *ngIf="category.imageUrl" [src]="category.imageUrl" [alt]="category.categoryItemName" class="w-full h-full object-cover rounded-lg" />
                            <i *ngIf="!category.imageUrl" class="pi pi-folder text-muted-color text-2xl"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-lg">{{ category.categoryItemName }}</div>
                            <div class="text-muted-color text-sm" *ngIf="category.description">{{ category.description }}</div>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="flex flex-col gap-2">
                        <p-chip [label]="category.categoryItemCode" styleClass="p-chip-sm" />
                        <p-tag [value]="(category.availableAccompaniments?.length || 0) + ' acompañamiento(s)'" severity="info" />
                    </div>
                </td>
                <td>
                    <div class="flex gap-1">
                        <p-button icon="pi pi-plus" [rounded]="true" [text]="true" size="small" (click)="selectExistingCategory(category)" pTooltip="Agregar acompañamiento" />
                        <p-button icon="pi pi-eye" severity="info" [rounded]="true" [text]="true" size="small" (click)="selectExistingCategory(category)" pTooltip="Ver detalles" />
                        <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [text]="true" size="small" (click)="deleteAllCategoryAccompaniments(category)" [disabled]="(category.availableAccompaniments?.length || 0) === 0" pTooltip="Eliminar todos los acompañamientos" />
                    </div>
                </td>
            </tr>
            <!-- Expanded Content Row -->
            <tr *ngIf="isRowExpanded(category.categoryItemCode)">
                <td colspan="4">
                    <div class="p-4">
                        <div *ngIf="category.availableAccompaniments && category.availableAccompaniments.length > 0">
                            <p-table [value]="category.availableAccompaniments" dataKey="accompanimentItemCode" styleClass="p-datatable-sm">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th style="width: 6rem">Imagen</th>
                                        <th pSortableColumn="accompanimentItemName">Nombre <p-sortIcon field="accompanimentItemName" /></th>
                                        <th pSortableColumn="accompanimentPrice">Precio <p-sortIcon field="accompanimentPrice" /></th>
                                        <th pSortableColumn="discount">Descuento <p-sortIcon field="discount" /></th>
                                        <th>Info Adicional</th>
                                        <th style="width: 8rem">Acciones</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-accompaniment>
                                    <tr>
                                        <td>
                                            <img *ngIf="accompaniment.accompanimentImageUrl" [src]="accompaniment.accompanimentImageUrl" [alt]="accompaniment.accompanimentItemName" class="w-12 h-12 object-cover rounded-md bg-surface-100" />
                                            <div *ngIf="!accompaniment.accompanimentImageUrl" class="w-12 h-12 rounded-md bg-surface-100 flex items-center justify-center">
                                                <i class="pi pi-image text-muted-color text-2xl"></i>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="font-semibold">{{ accompaniment.accompanimentItemName }}</div>
                                            <div class="text-muted-color font-mono text-sm">{{ accompaniment.accompanimentItemCode }}</div>
                                        </td>
                                        <td>
                                            <div class="flex flex-col">
                                                <span class="font-bold text-md">{{ formatPrice(hasDiscount(accompaniment) ? calculateDiscountedPrice(accompaniment) : accompaniment.accompanimentPrice) }}</span>
                                                <span *ngIf="hasDiscount(accompaniment)" class="text-sm line-through text-muted-color">
                                                    {{ formatPrice(accompaniment.accompanimentPrice) }}
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <p-tag *ngIf="hasDiscount(accompaniment)" [value]="getDiscountLabel(accompaniment.discount)" [severity]="getDiscountSeverity(accompaniment.discount)" />
                                            <span *ngIf="!hasDiscount(accompaniment)" class="text-muted-color text-sm">-</span>
                                        </td>
                                        <td>
                                            <div class="flex flex-col gap-2 text-sm">
                                                <div *ngIf="hasEnlargement(accompaniment)">
                                                    <span class="font-semibold">🔄 Ampliación: </span>
                                                    <span>{{ (accompaniment.enlargementItemCode && getProductByCode(accompaniment.enlargementItemCode)?.itemName) || accompaniment.enlargementItemCode }}</span>
                                                    <p-tag *ngIf="accompaniment.enlargementDiscount" [value]="accompaniment.enlargementDiscount + '%'" severity="info" styleClass="ml-1" />
                                                    <div class="text-xs text-muted-color">{{ accompaniment.enlargementItemCode }}</div>
                                                </div>
                                                <div>
                                                    <span class="font-semibold">Línea: </span>
                                                    <span>{{ accompaniment.lineNumber }}</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="flex gap-1">
                                                <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" size="small" (click)="selectExistingCategory(category)" pTooltip="Gestionar acompañamientos" />
                                                <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [text]="true" size="small" (click)="deleteAccompaniment(category, accompaniment)" pTooltip="Eliminar" />
                                            </div>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                        <div *ngIf="!category.availableAccompaniments || category.availableAccompaniments.length === 0" class="p-8 text-center text-muted-color">
                            <i class="pi pi-shopping-cart text-4xl mb-3 block text-orange-400"></i>
                            <h6 class="text-lg mb-2">Sin acompañamientos en esta categoría</h6>
                            <p class="mb-4">{{ category.categoryItemName }} no tiene acompañamientos configurados aún.</p>
                            <p-button label="Agregar Primer Acompañamiento" icon="pi pi-plus" severity="secondary" size="small" (click)="selectExistingCategory(category)" />
                        </div>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!-- Empty State - No Categories with Accompaniments -->
<div *ngIf="categories().length === 0 && !loading()" class="text-center text-muted-color py-12">
    <i class="pi pi-shopping-cart text-6xl mb-4 block text-blue-400"></i>
    <h4 class="text-2xl mb-4">¡Aún no hay acompañamientos registrados!</h4>
    <p class="mb-4">No se han configurado acompañamientos para ninguna categoría.</p>
    <p class="mb-6 text-sm">
        Los acompañamientos aparecerán aquí una vez que agregues productos complementarios a tus categorías.
    </p>
    <div class="flex justify-center gap-3">
        <p-button 
            label="Agregar Primer Acompañamiento" 
            icon="pi pi-plus" 
            severity="secondary"
            (onClick)="openNew()" />
        <p-button 
            label="Recargar" 
            icon="pi pi-refresh" 
            [outlined]="true"
            (onClick)="loadCategoriesWithAccompaniments()" />
    </div>
</div>

<!-- Loading State -->
<div *ngIf="loading()" class="text-center py-12">
    <i class="pi pi-spin pi-spinner text-4xl text-primary"></i>
    <p class="text-muted-color mt-4">Cargando acompañamientos...</p>
</div>

<!-- Category Selection Dialog (siguiendo patrón de ingredients) -->
<p-dialog [(visible)]="categorySelectionDialog" [style]="{ width: '80vw', maxWidth: '800px' }" header="Seleccionar Categoría para Acompañamientos" [modal]="true" (onHide)="hideCategorySelectionDialog()">
    <div *ngIf="availableCategories().length > 0">
        <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Buscar categoría:</label>
            <p-iconfield>
                <p-inputicon styleClass="pi pi-search" />
                <input pInputText type="text" [ngModel]="categorySearchTerm()" (ngModelChange)="categorySearchTerm.set($event)" placeholder="Buscar por código o nombre..." fluid />
            </p-iconfield>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto">
            <div *ngFor="let category of filteredAvailableCategories()" 
                 class="border border-surface-200 dark:border-surface-700 rounded-lg p-4 hover:bg-surface-50 dark:hover:bg-surface-800 cursor-pointer transition-colors"
                 (click)="selectCategory(category)">
                <div class="flex items-start gap-3">
                    <div class="w-12 h-12 bg-surface-100 dark:bg-surface-700 rounded flex items-center justify-center">
                        <img *ngIf="category.imageUrl" [src]="category.imageUrl" [alt]="category.categoryItemName" class="w-full h-full object-cover rounded" />
                        <i *ngIf="!category.imageUrl" class="pi pi-folder text-muted-color"></i>
                    </div>
                    <div class="flex-1">
                        <h6 class="font-semibold mb-1">{{ category.categoryItemName }}</h6>
                        <p class="text-sm text-muted-color mb-2">{{ category.categoryItemCode }}</p>
                        <p class="text-xs text-muted-color" *ngIf="category.description">{{ category.description }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div *ngIf="availableCategories().length === 0" class="text-center py-8">
        <i class="pi pi-folder-open text-4xl text-muted-color mb-4 block"></i>
        <h6 class="text-lg mb-2">No hay categorías disponibles</h6>
        <p class="text-muted-color">Primero debe registrar categorías en el sistema</p>
    </div>
</p-dialog>

<!-- Category Details Dialog -->
<p-dialog [(visible)]="categoryDialog" [style]="{ width: '90vw', maxWidth: '1000px' }" header="Detalles de Categoría" [modal]="true" (onHide)="hideCategoryDialog()">
    <div *ngIf="selectedCategory()">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-1">
                <div class="text-center">
                    <div class="w-32 h-32 mx-auto mb-4 bg-surface-100 dark:bg-surface-700 rounded-lg flex items-center justify-center overflow-hidden">
                        <img *ngIf="selectedCategory()!.imageUrl" 
                             [src]="selectedCategory()!.imageUrl" 
                             [alt]="selectedCategory()!.categoryItemName"
                             class="w-full h-full object-cover" />
                        <i *ngIf="!selectedCategory()!.imageUrl" class="pi pi-folder text-muted-color text-4xl"></i>
                    </div>
                    <h4 class="font-bold mb-2">{{ selectedCategory()!.categoryItemName }}</h4>
                    <p class="text-muted-color mb-4" *ngIf="selectedCategory()!.description">{{ selectedCategory()!.description }}</p>
                    <p-chip [label]="selectedCategory()!.categoryItemCode" />
                </div>
            </div>
            
            <div class="lg:col-span-2">
                <h5 class="font-semibold mb-4">Acompañamientos ({{ accompaniments().length }})</h5>
                <div class="max-h-96 overflow-y-auto">
                    <div class="space-y-3">
                        <div *ngFor="let acc of accompaniments()" 
                             class="flex items-center p-3 border border-surface-200 dark:border-surface-700 rounded-lg">
                            <div class="w-12 h-12 bg-surface-100 dark:bg-surface-700 rounded flex items-center justify-center mr-3">
                                <img *ngIf="acc.accompanimentImageUrl" [src]="acc.accompanimentImageUrl" class="w-full h-full object-cover rounded" />
                                <i *ngIf="!acc.accompanimentImageUrl" class="pi pi-image text-muted-color"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium">{{ acc.accompanimentItemName }}</div>
                                <div class="text-sm text-muted-color">{{ acc.accompanimentItemCode }}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold">{{ formatPrice(acc.accompanimentPrice) }}</div>
                                <p-tag *ngIf="hasDiscount(acc)" [value]="acc.discount + '%'" severity="success" styleClass="text-xs" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</p-dialog>

<!-- Accompaniment Management Dialog (siguiendo patrón de ingredients) -->
<p-dialog [(visible)]="accompanimentDialog" [style]="{ width: '90vw', maxWidth: '1000px' }" [header]="'Gestionar Acompañamientos - ' + (debugSelectedCategory?.categoryItemName || '')" [modal]="true" (onHide)="hideAccompanimentDialog()" [maximizable]="true">
    <div *ngIf="debugSelectedCategory">
        
        <!-- Category Info Header -->
        <div class="bg-surface-50 dark:bg-surface-800 p-4 rounded-lg mb-6">
            <div class="flex items-center gap-4">
                <div class="w-16 h-16 bg-surface-100 dark:bg-surface-700 rounded-lg flex items-center justify-center">
                    <img *ngIf="debugSelectedCategory!.imageUrl" [src]="debugSelectedCategory!.imageUrl" [alt]="debugSelectedCategory!.categoryItemName" class="w-full h-full object-cover rounded-lg" />
                    <i *ngIf="!debugSelectedCategory!.imageUrl" class="pi pi-folder text-muted-color text-2xl"></i>
                </div>
                <div class="flex-1">
                    <h4 class="font-semibold mb-1">{{ debugSelectedCategory!.categoryItemName }}</h4>
                    <p class="text-muted-color text-sm mb-2">{{ debugSelectedCategory!.categoryItemCode }}</p>
                    <p class="text-xs text-muted-color" *ngIf="debugSelectedCategory!.description">{{ debugSelectedCategory!.description }}</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-muted-color">Acompañamientos actuales</p>
                    <p class="text-2xl font-bold text-primary">{{ accompaniments().length }}</p>
                </div>
            </div>
        </div>

        <!-- Header con estadísticas -->
        <div class="bg-surface-50 dark:bg-surface-800 p-4 rounded mb-4">
            <div class="flex justify-between items-center mb-3">
                <h6 class="font-semibold">🍽️ Acompañamientos para: {{ debugSelectedCategory!.categoryItemName }}</h6>
                <p-button label="➕ Agregar Acompañamiento" icon="pi pi-plus" severity="secondary" (onClick)="addAccompaniment()" />
            </div>
        </div>

        <!-- Acompañamientos Existentes -->
        <div class="mb-6" *ngIf="accompaniments().length > 0">
            <h6 class="font-semibold mb-4 text-success">📋 Acompañamientos Existentes ({{ accompaniments().length }})</h6>
            <div class="space-y-3">
                <div *ngFor="let accompaniment of accompaniments(); let i = index" 
                     class="p-4 border-l-4 border-l-success-500 bg-success-50 dark:bg-success-900/20 rounded-r shadow-sm">
                    
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <span class="bg-success text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold">
                                {{ i + 1 }}
                            </span>
                            <span class="font-medium text-success-800 dark:text-success-200">{{ accompaniment.accompanimentItemName }}</span>
                        </div>
                        <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" 
                                  size="small" (click)="removeAccompaniment(accompaniment)" pTooltip="Eliminar acompañamiento" />
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-surface-100 dark:bg-surface-700 rounded flex items-center justify-center">
                                <img *ngIf="accompaniment.accompanimentImageUrl" 
                                     [src]="accompaniment.accompanimentImageUrl" 
                                     [alt]="accompaniment.accompanimentItemName" 
                                     class="w-10 h-10 object-cover rounded" />
                                <i *ngIf="!accompaniment.accompanimentImageUrl" class="pi pi-shopping-cart text-muted-color text-xl"></i>
                            </div>
                            <div>
                                <p class="font-semibold">{{ accompaniment.accompanimentItemName }}</p>
                                <small class="text-muted-color">{{ accompaniment.accompanimentItemCode }}</small>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-sm text-muted-color">Precio</p>
                            <p class="font-bold text-lg">{{ formatPrice(accompaniment.accompanimentPrice) }}</p>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-sm text-muted-color">Descuento</p>
                            <div class="flex items-center justify-center gap-2">
                                <span class="font-medium">{{ accompaniment.discount || 0 }}%</span>
                                <p-tag *ngIf="hasDiscount(accompaniment)" 
                                       [value]="accompaniment.discount + '% desc.'" 
                                       severity="success" />
                            </div>
                        </div>
                    </div>
                    
                    <div *ngIf="hasEnlargement(accompaniment)" class="mt-3 p-2 bg-surface-100 dark:bg-surface-700 rounded text-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="font-semibold">🔄 Producto ampliación: </span>
                                <span>{{ (accompaniment.enlargementItemCode && getProductByCode(accompaniment.enlargementItemCode)?.itemName) || accompaniment.enlargementItemCode }}</span>
                            </div>
                            <p-tag *ngIf="accompaniment.enlargementDiscount" 
                                   [value]="accompaniment.enlargementDiscount + '% desc.'" 
                                   severity="info" 
                                   styleClass="text-xs" />
                        </div>
                        <div class="text-xs text-muted-color mt-1">
                            Código: {{ accompaniment.enlargementItemCode }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Acompañamientos (slots) -->
        <div class="space-y-3" *ngIf="accompanimentSlots().length > 0">
            <h6 class="font-semibold mb-4 text-primary">➕ Nuevos Acompañamientos</h6>
            <div *ngFor="let slot of accompanimentSlots(); let i = index" 
                 class="p-4 border-l-4 border-l-primary-500 bg-surface-0 dark:bg-surface-900 rounded-r shadow-sm">
                
                <!-- Header del acompañamiento -->
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="bg-primary text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold">
                            {{ i + 1 }}
                        </span>
                        <span class="font-medium">Acompañamiento {{ i + 1 }}</span>
                    </div>
                    <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" 
                              size="small" (click)="removeAccompanimentSlot(i)" pTooltip="Eliminar acompañamiento" />
                </div>
                
                <!-- Selección de producto y datos -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block font-medium mb-2">🛒 Seleccionar Producto</label>
                        <p-select
                            [(ngModel)]="slot.accompanimentItemCode"
                            [options]="getAccompanimentOptionsForSlot(i)"
                            optionLabel="label"
                            optionValue="value"
                            placeholder="Seleccionar producto..."
                            [filter]="true"
                            filterPlaceholder="Buscar producto..."
                            [disabled]="getAccompanimentOptionsForSlot(i).length === 0"
                            appendTo="body"
                            fluid>
                        </p-select>
                        <small class="text-muted-color">Solo productos vendibles disponibles</small>
                    </div>
                    <div>
                        <label class="block font-medium mb-2">💰 Descuento (%)</label>
                        <p-inputnumber 
                            [(ngModel)]="slot.discount"
                            [min]="0" 
                            [max]="100"
                            [showButtons]="true" 
                            [disabled]="!slot.accompanimentItemCode"
                            suffix="%"
                            fluid />
                    </div>
                    <div>
                        <label class="block font-medium mb-2">🔄 Producto para Ampliación</label>
                        <p-select
                            [(ngModel)]="slot.enlargementItemCode"
                            [options]="getEnlargementProductOptions()"
                            optionLabel="label"
                            optionValue="value"
                            placeholder="Seleccionar producto..."
                            [filter]="true"
                            filterPlaceholder="Buscar producto..."
                            [disabled]="!slot.accompanimentItemCode"
                            appendTo="body"
                            fluid>
                        </p-select>
                        <small class="text-muted-color">Producto que se usará para la ampliación</small>
                    </div>
                    <div>
                        <label class="block font-medium mb-2">💸 Descuento Ampliación (%)</label>
                        <p-inputnumber 
                            [(ngModel)]="slot.enlargementDiscount"
                            [min]="0" 
                            [max]="100"
                            [showButtons]="true" 
                            [disabled]="!slot.accompanimentItemCode || !slot.enlargementItemCode"
                            suffix="%"
                            placeholder="Opcional"
                            fluid />
                        <small class="text-muted-color">Solo si hay código de ampliación</small>
                    </div>
                </div>
                
                <!-- Información del producto seleccionado -->
                <div *ngIf="slot.accompanimentItemCode" class="mt-4 p-3 bg-surface-50 dark:bg-surface-800 rounded">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-surface-100 dark:bg-surface-700 rounded flex items-center justify-center">
                            <img *ngIf="getProductByCode(slot.accompanimentItemCode)?.imageUrl" 
                                 [src]="getProductByCode(slot.accompanimentItemCode)!.imageUrl" 
                                 [alt]="getProductByCode(slot.accompanimentItemCode)!.itemName" 
                                 class="w-10 h-10 object-cover rounded" />
                            <i *ngIf="!getProductByCode(slot.accompanimentItemCode)?.imageUrl" class="pi pi-shopping-cart text-muted-color text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-semibold">{{ getProductByCode(slot.accompanimentItemCode)?.itemName }}</p>
                            <small class="text-muted-color">Código: {{ slot.accompanimentItemCode }}</small>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-sm font-medium">{{ formatPrice(getProductByCode(slot.accompanimentItemCode)?.price || 0) }}</span>
                                <p-tag *ngIf="slot.discount && slot.discount > 0" 
                                       [value]="slot.discount + '% desc.'" 
                                       severity="success" />
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mensaje si no hay productos disponibles -->
                <div *ngIf="getAccompanimentOptionsForSlot(i).length === 0 && !slot.accompanimentItemCode" 
                     class="mt-3 p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded">
                    <div class="flex items-center gap-2 text-orange-600 dark:text-orange-400">
                        <i class="pi pi-exclamation-triangle"></i>
                        <span class="text-sm">No hay más productos disponibles. Todos los productos vendibles ya están en uso.</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Estado vacío -->
        <div *ngIf="accompaniments().length === 0 && accompanimentSlots().length === 0" class="text-center text-muted-color py-12">
            <i class="pi pi-shopping-cart text-6xl mb-4 block"></i>
            <h6 class="text-xl mb-2">🍽️ Sin Acompañamientos</h6>
            <p class="mb-4">Esta categoría no tiene acompañamientos configurados</p>
            <p-button 
                label="Agregar Primer Acompañamiento" 
                icon="pi pi-plus" 
                (onClick)="addAccompaniment()" />
        </div>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex justify-between items-center w-full">
            <div class="flex items-center gap-4 text-sm">
                <div class="flex items-center gap-2">
                    <i class="pi pi-folder text-primary"></i>
                    <span class="font-medium">{{ debugSelectedCategory?.categoryItemName }}</span>
                </div>
                <div class="flex items-center gap-2 text-muted-color">
                    <i class="pi pi-shopping-cart"></i>
                    <span>{{ accompanimentSlots().length }} acompañamiento(s) en preparación</span>
                </div>
                <div class="flex items-center gap-2 text-muted-color">
                    <i class="pi pi-list"></i>
                    <span>{{ accompaniments().length }} guardado(s)</span>
                </div>
            </div>
            <div class="flex gap-2">
                <p-button label="Cancelar" icon="pi pi-times" outlined (click)="hideAccompanimentDialog()" />
                <p-button 
                    label="💾 Guardar Acompañamientos" 
                    icon="pi pi-check" 
                    [loading]="loading()" 
                    [disabled]="accompanimentSlots().length === 0 || !hasValidSlots()"
                    (click)="saveAllAccompaniments()" />
            </div>
        </div>
    </ng-template>
</p-dialog>

<p-confirmdialog [style]="{ width: '450px' }" acceptLabel="Sí" rejectLabel="No" acceptButtonStyleClass="p-button-danger" rejectButtonStyleClass="p-button-secondary" />
<p-toast />
